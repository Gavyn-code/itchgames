<!DOCTYPE html>
<html lang="en">
<head>
  <!-- [LOCK START] 基础头 -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- [SEO LOCK] 后续扩展区 -->
  <meta name="description" content="Itch Games - Premium Game Directory">
  <title>Itch Games | Game Directory</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* [COLOR LOCK] 苹果色系定义 */
    :root {
      --apple-light: #f5f5f7;
      --apple-dark: #1d1d1f;
      --apple-blue: #2997ff;
    }
  </style>
  <!-- [LOCK END] -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          lineClamp: {
            3: '3',
          }
        }
      }
    }
  </script>
  <!-- [LOCK] 在<head>末尾添加 -->
  <!-- [SEO SECTION] -->
  <meta name="description" content="Itch Games offers curated premium web games with an immersive instant play experience.">
  <link rel="canonical" href="https://itchgames.info">
  <meta property="og:title" content="Itch Games | Game Directory">
  <meta property="og:description" content="Curated premium web games with an immersive instant play experience">
  <meta property="og:url" content="https://itchgames.info">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://itchgames.info/images/og-image.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Itch Games | Game Directory">
  <meta name="twitter:description" content="Curated premium web games with an immersive instant play experience">
  <meta name="twitter:image" content="https://itchgames.info/images/twitter-card.jpg">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Itch Games",
    "url": "https://itchgames.info",
    "description": "Premium web game directory platform",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "{search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@type": "Game",
          "name": "Sprunki",
          "description": "Join Sprunki on an exciting adventure through colorful worlds. Overcome obstacles, collect items, and discover hidden secrets in this engaging platformer game.",
          "genre": "Adventure",
          "url": "https://itchgames.info/games/sprunki"
        }
      },
      {
        "@type": "ListItem",
        "position": 2,
        "item": {
          "@type": "Game",
          "name": "Sprunki Phase 3",
          "description": "Sprunki is back with Phase 3! New levels, enhanced gameplay, and more challenging obstacles in this sequel to the popular platformer.",
          "genre": "Adventure",
          "url": "https://itchgames.info/games/sprunki-phase-3"
        }
      },
      {
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@type": "Game",
          "name": "Sprunki Roblox",
          "description": "Experience Sprunki in the Roblox universe! Build, explore, and embark on adventures with friends in this exciting crossover.",
          "genre": "Adventure",
          "url": "https://itchgames.info/games/sprunki-roblox"
        }
      }
    ]
  }
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-JSN7QDL3PN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-JSN7QDL3PN');
  </script>
</head>

<body class="bg-[var(--apple-light)] text-[var(--apple-dark)] font-[-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif]">
  <!-- [LOCK] 主体容器 -->
  <main class="container mx-auto px-4 md:px-8 lg:px-16">
    <!-- [MODIFIABLE] 内容区 -->
    <section id="nav-bar" class="py-6 sticky top-0 bg-[var(--apple-light)] z-10">
      <div class="flex justify-between items-center">
        <h1 class="text-xl font-bold md:text-2xl">Itch Games</h1>
      </div>
      
      <!-- [MODIFIABLE START] 在#nav-bar内添加 -->
      <nav class="flex overflow-x-auto pb-2 space-x-4 mt-4">
        <button class="px-4 py-2 rounded-full bg-[var(--apple-blue)] text-white whitespace-nowrap category-btn" data-category="All" onclick="filterGames('All')">All</button>
        <button class="px-4 py-2 rounded-full bg-white/50 whitespace-nowrap hover:bg-white/70 transition-all duration-300 category-btn" data-category="Adventure" onclick="filterGames('Adventure')">Adventure</button>
      </nav>
    </section>
    
    <section id="game-grid" class="grid grid-cols-2 gap-2 p-2 md:grid-cols-4 md:gap-4 md:p-4 pb-8">
      <!-- [MODIFIABLE] 在#game-grid内添加 -->
      <div class="relative group cursor-pointer" onclick="showGameModal('sprunki', 'Adventure', 'Join Sprunki on an exciting adventure through colorful worlds. Overcome obstacles, collect items, and discover hidden secrets in this engaging platformer game.')">
        <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300">
          <div class="aspect-video bg-gray-100 rounded-t-xl flex items-center justify-center bg-[#3498db] overflow-hidden">
            <img src="https://cdn.sprunki.com/img/incredibox-sprunki.webp" alt="Sprunki" class="w-full h-full object-cover" loading="lazy" decoding="async">
          </div>
          <div class="p-4">
            <h3 class="font-semibold text-lg">Sprunki</h3>
            <span class="text-[var(--apple-blue)] text-sm">Adventure</span>
            <p class="text-gray-600 mt-2 line-clamp-3">Join Sprunki on an exciting adventure through colorful worlds. Overcome obstacles and discover hidden secrets.</p>
          </div>
        </div>
      </div>
      
      <div class="relative group cursor-pointer" onclick="showGameModal('sprunki-phase-3', 'Adventure', 'Sprunki is back with Phase 3! New levels, enhanced gameplay, and more challenging obstacles in this sequel to the popular platformer. Discover new power-ups and special abilities as you progress through beautifully designed levels.')">
        <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300">
          <div class="aspect-video bg-gray-100 rounded-t-xl flex items-center justify-center bg-[#9b59b6] overflow-hidden">
            <img src="https://cdn.sprunki.com/img/sprunki-phase-3.webp" alt="Sprunki Phase 3" class="w-full h-full object-cover" loading="lazy" decoding="async">
          </div>
          <div class="p-4">
            <h3 class="font-semibold text-lg">Sprunki Phase 3</h3>
            <span class="text-[var(--apple-blue)] text-sm">Adventure</span>
            <p class="text-gray-600 mt-2 line-clamp-3">New levels, enhanced gameplay, and more challenging obstacles in this sequel to the popular Sprunki platformer.</p>
          </div>
        </div>
      </div>
      
      <div class="relative group cursor-pointer" onclick="showGameModal('sprunki-roblox', 'Adventure', 'Experience Sprunki in the Roblox universe! This special edition brings your favorite character into a blocky 3D world with multiplayer capabilities. Build, explore, and embark on adventures with friends in this exciting crossover.')">
        <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300">
          <div class="aspect-video bg-gray-100 rounded-t-xl flex items-center justify-center bg-[#e74c3c] overflow-hidden">
            <img src="https://cdn.sprunki.com/img/sprunki-roblox.webp" alt="Sprunki Roblox" class="w-full h-full object-cover" loading="lazy" decoding="async">
          </div>
          <div class="p-4">
            <h3 class="font-semibold text-lg">Sprunki Roblox</h3>
            <span class="text-[var(--apple-blue)] text-sm">Adventure</span>
            <p class="text-gray-600 mt-2 line-clamp-3">Experience Sprunki in the Roblox universe! Build, explore, and embark on adventures with friends in this exciting crossover.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- [MODIFIABLE] 在</main>前添加悬浮层 -->
    <div id="game-modal" class="hidden fixed inset-0 bg-black/50 z-40 transition-all duration-300 ease-in-out">
      <div class="bg-white rounded-xl w-full md:w-4/5 h-[80vh] absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 shadow-2xl transition-all duration-300 ease-in-out opacity-0 scale-95" id="modal-content">
        <button onclick="closeGameModal()" class="absolute top-4 right-4 z-50 bg-white/80 rounded-full p-3 shadow-md hover:bg-white transition-all duration-300 w-12 h-12 flex items-center justify-center min-w-[44px] min-h-[44px]">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
        <div class="relative w-full h-[60vh]" id="game-container">
          <iframe 
            class="w-full h-full border-none rounded-t-xl bg-gray-100" 
            id="game-frame"
            loading="lazy"
            decoding="async"
            frameborder="0"
            allow="autoplay; fullscreen"
            title="Game Content"
          ></iframe>
          <button onclick="toggleFullscreen()" id="fullscreen-btn" class="absolute bottom-4 right-4 z-50 bg-white/80 rounded-full p-3 shadow-md hover:bg-white transition-all duration-300 w-12 h-12 flex items-center justify-center min-w-[44px] min-h-[44px]">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 fullscreen-enter">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 fullscreen-exit hidden">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25" />
            </svg>
          </button>
        </div>
        <div class="p-6 h-[40vh] max-h-calc(40vh - 64px) overflow-y-auto touch-pan-y overscroll-contain">
          <div class="flex items-center gap-2 mb-2">
            <h2 class="text-2xl font-bold" id="modal-title">Game Title</h2>
            <span class="text-[var(--apple-blue)] text-sm px-3 py-1 rounded-full bg-[var(--apple-blue)]/10" id="modal-category">Category</span>
          </div>
          <p class="text-gray-700" id="modal-description">Loading game description...</p>
        </div>
      </div>
    </div>
  </main>

  <script>
    // DOM加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化暗黑模式检测
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark-mode');
      }
      
      // 监听系统暗黑模式变化
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (e.matches) {
          document.body.classList.add('dark-mode');
        } else {
          document.body.classList.remove('dark-mode');
        }
      });
      
      // 初始化游戏分类过滤器
      filterGames('All');
    });

    // 游戏分类过滤功能
    function filterGames(category) {
      // 更新分类按钮样式
      const buttons = document.querySelectorAll('.category-btn');
      buttons.forEach(btn => {
        if (btn.dataset.category === category) {
          btn.classList.add('bg-[var(--apple-blue)]', 'text-white');
          btn.classList.remove('bg-white/50', 'hover:bg-white/70');
        } else {
          btn.classList.remove('bg-[var(--apple-blue)]', 'text-white');
          btn.classList.add('bg-white/50', 'hover:bg-white/70');
        }
      });
      
      // 过滤游戏卡片
      const gameCards = document.querySelectorAll('#game-grid > div');
      gameCards.forEach(card => {
        // 直接从onclick属性中获取游戏分类
        const onclickAttr = card.getAttribute('onclick');
        // 使用正则表达式从onclick属性中提取分类名称
        const categoryMatch = onclickAttr.match(/'([^']*)',\s*'([^']*)'/);
        const gameCategory = categoryMatch ? categoryMatch[2] : '';
        
        if (category === 'All' || gameCategory === category) {
          card.classList.remove('hidden');
        } else {
          card.classList.add('hidden');
        }
      });
    }

    // [LOCK] 增强版加载逻辑
    function showGameModal(gameId, category, description) {
      const modal = document.getElementById('game-modal');
      const modalContent = document.getElementById('modal-content');
      const iframe = document.getElementById('game-frame');
      
      // 设置内容
      document.getElementById('modal-title').textContent = gameId.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
      document.getElementById('modal-category').textContent = category;
      document.getElementById('modal-description').textContent = description;
      
      // 显示模态框
      modal.classList.remove('hidden');
      
      // 延迟加载iframe内容
      setTimeout(() => {
        // 特定游戏使用指定URL
        if (gameId === 'sprunki') {
          iframe.src = 'https://game.sprunki.com/game.sprunki.html';
        } else if (gameId === 'sprunki-phase-3') {
          iframe.src = 'https://iframegame.com/embed/sprunki-phase-3/index.html';
        } else if (gameId === 'sprunki-roblox') {
          iframe.src = 'https://game.sprunki.com/sprunkiroblox.html';
        } else {
          iframe.src = `https://cdn.games/${gameId}/index.html`;
        }
      }, 300);
      
      // 添加动画效果
      setTimeout(() => {
        modalContent.classList.remove('opacity-0', 'scale-95');
        modalContent.classList.add('opacity-100', 'scale-100');
      }, 10);
      
      // 阻止body滚动，但保持模态内容可滚动
      document.body.style.overflow = 'hidden';
      
      // 动态更新结构化数据
      const schemaScript = document.querySelector('script[type="application/ld+json"]:last-of-type');
      const schemaData = JSON.parse(schemaScript.textContent);
      
      // 检查游戏是否已存在于列表中
      const existingIndex = schemaData.itemListElement.findIndex(item => 
        item.item && item.item.name.toLowerCase() === gameId.replace(/-/g, ' ').toLowerCase()
      );
      
      if (existingIndex === -1) {
        // 添加新游戏到结构化数据
        schemaData.itemListElement.push({
          "@type": "ListItem",
          "position": schemaData.itemListElement.length + 1,
          "item": {
            "@type": "Game",
            "name": gameId.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
            "description": description,
            "genre": category,
            "url": gameId === 'sprunki' ? 'https://game.sprunki.com/game.sprunki.html' : 
                   gameId === 'sprunki-phase-3' ? 'https://iframegame.com/embed/sprunki-phase-3/index.html' : 
                   gameId === 'sprunki-roblox' ? 'https://game.sprunki.com/sprunkiroblox.html' : 
                   `https://cdn.games/${gameId}/index.html`
          }
        });
        
        // 更新结构化数据
        schemaScript.textContent = JSON.stringify(schemaData, null, 2);
      }
    }
    
    function closeGameModal() {
      const modal = document.getElementById('game-modal');
      const modalContent = document.getElementById('modal-content');
      const iframe = document.getElementById('game-frame');
      const gameContainer = document.getElementById('game-container');
      
      // 退出全屏模式（如果处于全屏状态）
      if (document.fullscreenElement || 
          document.webkitFullscreenElement || 
          document.mozFullScreenElement ||
          document.msFullscreenElement) {
        exitFullscreen();
      }
      
      // 检查是否处于模拟全屏状态
      if (gameContainer.classList.contains('is-fullscreen')) {
        document.body.style.overflow = '';
        gameContainer.classList.remove('is-fullscreen');
        
        // 解除屏幕方向锁定
        try {
          if (screen.orientation && screen.orientation.unlock) {
            screen.orientation.unlock();
          }
        } catch (e) {
          console.log('无法解除屏幕方向锁定:', e);
        }
      }
      
      // 添加关闭动画
      modalContent.classList.remove('opacity-100', 'scale-100');
      modalContent.classList.add('opacity-0', 'scale-95');
      
      // 延迟隐藏和重置iframe
      setTimeout(() => {
        modal.classList.add('hidden');
        // 清空iframe src以防止资源占用和音频继续播放
        iframe.src = '';
        // 恢复body滚动
        document.body.style.overflow = '';
      }, 300);
    }
    
    // 全屏控制功能
    function toggleFullscreen() {
      const gameContainer = document.getElementById('game-container');
      const gameFrame = document.getElementById('game-frame');
      const modalContent = document.getElementById('modal-content');
      const enterIcon = document.querySelector('.fullscreen-enter');
      const exitIcon = document.querySelector('.fullscreen-exit');
      const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      
      if (gameContainer.classList.contains('is-fullscreen') || 
          document.fullscreenElement || 
          document.webkitFullscreenElement || 
          document.mozFullScreenElement ||
          document.msFullscreenElement) {
        // 退出全屏模式
        
        // 恢复正常滚动
        document.body.style.overflow = '';
        gameContainer.classList.remove('is-fullscreen');
        document.body.classList.remove('game-fullscreen');
        modalContent.classList.remove('is-fullscreen');
        
        // 解除屏幕方向锁定（移动设备）
        if (isMobile) {
          try {
            if (screen.orientation && screen.orientation.unlock) {
              screen.orientation.unlock();
            }
          } catch (e) {
            console.log('无法解除屏幕方向锁定:', e);
          }
        }
        
        // 处理按钮图标
        enterIcon.classList.remove('hidden');
        exitIcon.classList.add('hidden');
        
        // 处理原生全屏API
        if (document.fullscreenElement || 
            document.webkitFullscreenElement || 
            document.mozFullScreenElement ||
            document.msFullscreenElement) {
          exitFullscreen();
        }
        
        // 移除额外的退出按钮（如果存在）
        const extraExitBtn = document.getElementById('extra-exit-fullscreen-btn');
        if (extraExitBtn) {
          extraExitBtn.remove();
        }
      } else {
        // 进入全屏模式
        
        // 防止背景滚动
        document.body.style.overflow = 'hidden';
        
        // 更新按钮图标
        enterIcon.classList.add('hidden');
        exitIcon.classList.remove('hidden');
        
        // 特殊处理移动设备
        if (isMobile) {
          // 使用模拟全屏而非原生API（更可靠）
          gameContainer.classList.add('is-fullscreen');
          document.body.classList.add('game-fullscreen');
          modalContent.classList.add('is-fullscreen');
          
          // 尝试锁定屏幕方向
          try {
            if (screen.orientation && screen.orientation.lock) {
              screen.orientation.lock('landscape').catch(e => console.log('无法锁定屏幕方向:', e));
            }
          } catch (e) {
            console.log('屏幕方向API不可用:', e);
          }
          
          // 添加额外的退出全屏按钮（更明显、更大）
          if (!document.getElementById('extra-exit-fullscreen-btn')) {
            const extraExitBtn = document.createElement('button');
            extraExitBtn.id = 'extra-exit-fullscreen-btn';
            extraExitBtn.className = 'fixed z-[10001] mobile-exit-btn bg-white/90 rounded-full shadow-lg w-16 h-16 flex items-center justify-center';
            extraExitBtn.style.bottom = '20px';
            extraExitBtn.style.right = '20px';
            extraExitBtn.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25" />
              </svg>
            `;
            extraExitBtn.addEventListener('click', toggleFullscreen);
            document.body.appendChild(extraExitBtn);
          }
        } else {
          // 桌面设备：优先使用原生全屏API，但同时保留退出按钮
          try {
            if (gameContainer.requestFullscreen) {
              gameContainer.requestFullscreen().catch(e => {
                console.log('原生全屏请求失败，使用模拟全屏:', e);
                // 如果原生API失败，回退到模拟全屏
                useSimulatedFullscreen();
              });
            } else if (gameContainer.webkitRequestFullscreen) {
              gameContainer.webkitRequestFullscreen();
            } else if (gameContainer.msRequestFullscreen) {
              gameContainer.msRequestFullscreen();
            } else if (gameContainer.mozRequestFullScreen) {
              gameContainer.mozRequestFullScreen();
            } else {
              // 如果没有可用的原生API，使用模拟全屏
              useSimulatedFullscreen();
            }
            
            // 为桌面端添加额外的全屏退出按钮（备用）
            if (!document.getElementById('extra-exit-fullscreen-btn')) {
              const extraExitBtn = document.createElement('button');
              extraExitBtn.id = 'extra-exit-fullscreen-btn';
              extraExitBtn.className = 'fixed z-[99999] desktop-exit-btn bg-white/80 rounded-full shadow-lg w-14 h-14 flex items-center justify-center';
              extraExitBtn.style.bottom = '20px';
              extraExitBtn.style.right = '20px';
              extraExitBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-7 h-7">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25" />
                </svg>
              `;
              extraExitBtn.addEventListener('click', toggleFullscreen);
              document.body.appendChild(extraExitBtn);
            }
          } catch (e) {
            console.log('原生全屏API异常，使用模拟全屏:', e);
            useSimulatedFullscreen();
          }
        }
      }
    }
    
    // 辅助函数：使用模拟全屏
    function useSimulatedFullscreen() {
      const gameContainer = document.getElementById('game-container');
      const modalContent = document.getElementById('modal-content');
      gameContainer.classList.add('is-fullscreen');
      modalContent.classList.add('is-fullscreen');
      document.body.classList.add('game-fullscreen');
    }
    
    function exitFullscreen() {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) { /* Safari */
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) { /* IE11 */
        document.msExitFullscreen();
      } else if (document.mozCancelFullScreen) { /* Firefox */
        document.mozCancelFullScreen();
      }
    }
    
    // 监听全屏变化事件
    document.addEventListener('fullscreenchange', updateFullscreenIcon);
    document.addEventListener('webkitfullscreenchange', updateFullscreenIcon);
    document.addEventListener('mozfullscreenchange', updateFullscreenIcon);
    document.addEventListener('MSFullscreenChange', updateFullscreenIcon);
    
    function updateFullscreenIcon() {
      const enterIcon = document.querySelector('.fullscreen-enter');
      const exitIcon = document.querySelector('.fullscreen-exit');
      const gameContainer = document.getElementById('game-container');
      
      if (document.fullscreenElement || 
          document.webkitFullscreenElement || 
          document.mozFullScreenElement ||
          document.msFullscreenElement) {
        enterIcon.classList.add('hidden');
        exitIcon.classList.remove('hidden');
      } else {
        // 检查是否处于模拟全屏状态（移动设备）
        if (!gameContainer.classList.contains('is-fullscreen')) {
          enterIcon.classList.remove('hidden');
          exitIcon.classList.add('hidden');
        }
      }
    }
    
    // 监听ESC键，用于退出模拟全屏
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' || e.keyCode === 27) {
        const gameContainer = document.getElementById('game-container');
        if (gameContainer.classList.contains('is-fullscreen')) {
          toggleFullscreen();
        }
      }
    });
    
    // 点击背景关闭
    document.getElementById('game-modal').onclick = (e) => {
      if(e.target === document.getElementById('game-modal')) {
        closeGameModal();
      }
    }
    
    // 阻止触摸事件传播，隔离滚动
    document.querySelector('#game-modal .touch-pan-y').addEventListener('touchmove', function(e) {
      e.stopPropagation();
    }, { passive: true });
  </script>
  
  <style>
    /* 暗黑模式支持 */
    @media (prefers-color-scheme: dark) {
      .dark-mode {
        --apple-light: #1d1d1f;
        --apple-dark: #f5f5f7;
      }
      
      .dark-mode .bg-white {
        background-color: #2c2c2e;
      }
      
      .dark-mode .text-gray-600,
      .dark-mode .text-gray-700 {
        color: #e5e5ea;
      }
      
      .dark-mode .bg-white\/50 {
        background-color: rgba(44, 44, 46, 0.5);
      }
      
      .dark-mode .bg-white\/80 {
        background-color: rgba(44, 44, 46, 0.8);
      }
    }
    
    /* 设置系统字体栈 */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }
    
    /* 修复Safari中的iframe显示问题 */
    iframe {
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
    }
    
    /* 修复max-height计算 */
    .max-h-calc\(40vh\ -\ 64px\) {
      max-height: calc(40vh - 64px);
    }
    
    /* 全屏模式样式优化 */
    :fullscreen #game-container,
    :-webkit-full-screen #game-container,
    :-moz-full-screen #game-container,
    :-ms-fullscreen #game-container {
      width: 100vw;
      height: 100vh;
      padding: 0;
      margin: 0;
      display: flex;
    }
    
    /* 确保全屏下的iframe尺寸正确 */
    :fullscreen #game-frame,
    :-webkit-full-screen #game-frame,
    :-moz-full-screen #game-frame,
    :-ms-fullscreen #game-frame {
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      position: absolute;
      top: 0;
      left: 0;
    }
    
    /* 确保全屏模式下按钮可见 */
    :fullscreen #fullscreen-btn,
    :-webkit-full-screen #fullscreen-btn,
    :-moz-full-screen #fullscreen-btn,
    :-ms-fullscreen #fullscreen-btn {
      position: fixed !important;
      bottom: 20px !important;
      right: 20px !important;
      z-index: 99999 !important;
      background-color: rgba(255, 255, 255, 0.8) !important;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3) !important;
      display: flex !important;
      opacity: 0.9 !important;
    }
    
    /* 桌面全屏按钮悬停效果 */
    :fullscreen #fullscreen-btn:hover,
    :-webkit-full-screen #fullscreen-btn:hover,
    :-moz-full-screen #fullscreen-btn:hover,
    :-ms-fullscreen #fullscreen-btn:hover {
      background-color: rgba(255, 255, 255, 0.95) !important;
      opacity: 1 !important;
    }
    
    /* 移动端全屏按钮触控区域优化 */
    @media (max-width: 768px) {
      #fullscreen-btn {
        bottom: 16px;
        right: 16px;
        min-width: 48px;
        min-height: 48px;
        width: 48px;
        height: 48px;
      }
      
      :fullscreen #fullscreen-btn,
      :-webkit-full-screen #fullscreen-btn,
      :-moz-full-screen #fullscreen-btn,
      :-ms-fullscreen #fullscreen-btn {
        bottom: 20px;
        right: 20px;
        width: 56px;
        height: 56px;
        min-width: 56px;
        min-height: 56px;
      }
    }
    
    /* 修复Safari和iOS设备上的全屏问题 */
    @supports (-webkit-touch-callout: none) {
      #game-container.is-fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100vw;
        height: 100vh;
        z-index: 10000;
        background: black;
      }
      
      #game-container.is-fullscreen #game-frame {
        width: 100vw;
        height: 100vh;
        border-radius: 0;
      }
    }
    
    /* 手机端全屏模式增强 */
    #game-container.is-fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100vw;
      height: 100vh;
      z-index: 10000;
      background-color: #000;
    }
    
    #game-container.is-fullscreen #game-frame {
      width: 100%;
      height: 100%;
      border-radius: 0;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 10000;
    }
    
    /* 模态框全屏样式 */
    #modal-content.is-fullscreen {
      width: 100% !important;
      height: 100% !important;
      background: black;
      top: 0 !important;
      left: 0 !important;
      transform: none !important;
      transition: none !important;
      border-radius: 0 !important;
    }

    /* 模态框全屏时隐藏描述部分 */
    #modal-content.is-fullscreen .p-6 {
      display: none !important;
    }
    
    /* 模态框全屏时修改游戏容器高度 */
    #modal-content.is-fullscreen #game-container {
      height: 100vh !important;
    }
    
    /* 模态框全屏时隐藏关闭按钮 */
    #modal-content.is-fullscreen > button:first-of-type {
      display: none !important;
    }
    
    /* 禁用模拟全屏时的滚动 */
    body.game-fullscreen {
      overflow: hidden !important;
      position: fixed;
      width: 100%;
      height: 100%;
    }
    
    /* 确保模拟全屏时退出按钮一直可见 */
    #game-container.is-fullscreen #fullscreen-btn {
      position: fixed !important;
      z-index: 99999 !important;
      display: flex !important;
    }
    
    /* 额外的退出全屏按钮样式 */
    #extra-exit-fullscreen-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 10001;
      background-color: rgba(255, 255, 255, 0.9);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      width: 64px;
      height: 64px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    
    /* 桌面端全屏按钮样式 */
    .desktop-exit-btn {
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }
    
    .desktop-exit-btn:hover {
      opacity: 1;
      background-color: rgba(255, 255, 255, 0.95) !important;
    }
    
    /* 横屏模式支持 */
    @media screen and (orientation: landscape) {
      #game-container.is-fullscreen {
        width: 100vw;
        height: 100vh;
      }
      
      #game-container.is-fullscreen #game-frame {
        width: 100%;
        height: 100%;
      }
      
      /* 确保横屏下退出按钮位置正确 */
      #extra-exit-fullscreen-btn {
        bottom: 20px;
        right: 20px;
        transform: none;
      }
    }
    
    /* 竖屏模式下模拟横屏 */
    @media screen and (orientation: portrait) {
      #game-container.is-fullscreen {
        transform: rotate(90deg);
        transform-origin: bottom left;
        width: 100vh; /* 交换宽高 */
        height: 100vw;
        position: absolute;
        top: -100vw;
        left: 0;
        overflow: hidden;
      }
      
      #game-container.is-fullscreen #game-frame {
        width: 100%;
        height: 100%;
      }
      
      /* 模态框在竖屏模式下也需要旋转 */
      #modal-content.is-fullscreen {
        transform: rotate(90deg) !important;
        transform-origin: bottom left !important;
        width: 100vh !important; 
        height: 100vw !important;
        position: absolute !important;
        top: -100vw !important;
        left: 0 !important;
      }
      
      /* 竖屏模式下调整退出按钮位置 */
      #extra-exit-fullscreen-btn {
        transform: rotate(-90deg);
        bottom: 20px;
        right: 20px;
      }
    }
    
    /* iOS特殊处理 */
    @supports (-webkit-touch-callout: none) {
      /* iOS设备特定样式 */
      #game-container.is-fullscreen {
        position: fixed;
        height: 100vh;
        width: 100vw;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 10000;
      }
      
      /* 强制iOS上的退出按钮可见 */
      #extra-exit-fullscreen-btn {
        position: fixed !important;
        z-index: 100000 !important;
        /* 增加按钮尺寸以便于触控 */
        width: 72px !important;
        height: 72px !important;
      }
    }
    
    /* 确保原生全屏下按钮可见 - 特别针对桌面端 */
    :fullscreen #extra-exit-fullscreen-btn,
    :-webkit-full-screen #extra-exit-fullscreen-btn,
    :-moz-full-screen #extra-exit-fullscreen-btn,
    :-ms-fullscreen #extra-exit-fullscreen-btn {
      display: flex !important;
      z-index: 99999 !important;
      position: fixed !important;
      bottom: 20px !important;
      right: 20px !important;
    }
    
    /* 确保全屏时原按钮也可见 */
    :fullscreen .fullscreen-exit,
    :-webkit-full-screen .fullscreen-exit,
    :-moz-full-screen .fullscreen-exit,
    :-ms-fullscreen .fullscreen-exit {
      display: block !important;
    }
  </style>
</body>
</html> 